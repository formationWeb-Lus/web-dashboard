<%- include('../partials/header') %>

<nav>
  <ul class="nav">
    <li><a href="/dashboard">📍 Position</a></li>
    <li><a href="/history" class="active">📜 Historique</a></li>
    <li><a href="/stop">⛔ Arrêt</a></li>
    <li><a href="/map">🗺️ Carte</a></li>
    <li><a href="/settings">⚙️ Paramètres</a></li>
  </ul>
</nav>

<h2>📜 Historique des véhicules</h2>

<div class="select-wrapper" style="text-align:center; margin-bottom:10px;">
  <form method="GET" action="/history">
    <label for="vehSelect">Sélectionner un véhicule : </label>
    <select id="vehSelect" name="vehicule" onchange="this.form.submit()">
      <option value="all" <%= selectedVehicule === 'all' ? 'selected' : '' %>>Tous les véhicules</option>
      <% vehicules.forEach(v => { %>
        <option value="<%= v %>" <%= selectedVehicule === v ? 'selected' : '' %>><%= v %></option>
      <% }) %>
    </select>
  </form>
</div>

<% if (history.length > 0) { %>
  <table>
    <thead>
      <tr>
        <th>Véhicule</th>
        <th>Type</th>
        <th>Date & Heure</th>
        <th>Latitude</th>
        <th>Longitude</th>
        <th>Distance (m)</th>
      </tr>
    </thead>
    <tbody>
      <% history.forEach(entry => { %>
        <tr>
          <td><%= entry.vehiculeid %></td>
          <td><%= entry.type %></td>
          <td><%= entry.timestamp.toLocaleString() %></td>
          <td><%= entry.lat %></td>
          <td><%= entry.lng %></td>
          <td><%= entry.distance || '-' %></td>
        </tr>
      <% }) %>
    </tbody>
  </table>
<% } else { %>
  <p>Aucun historique disponible pour le véhicule sélectionné.</p>
<% } %>

<%- include('../partials/footer') %>
